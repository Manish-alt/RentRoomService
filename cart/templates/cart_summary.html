{% load static %}

<!DOCTYPE html>
<html lang="en">
    <!-- Header Section -->
    {% include 'head.html' %}
  
    
    <body>
        <!-- Navigation-->
        {% include 'navb.html' %}

        {% if messages %}
            {% for message in messages %}
            <div class="alert alert-warning alert-dismissible fade show" role="alert"> 
                {{ message }}
                <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="btn-close"></button>
            </div>
            {% endfor %}
        {% endif %}

                {% if cart_products %}
                {% for product in cart_products %}
                <div class="container">
                    <br/>
                    <div class="card md-3">
                    <div class="row g-0">
                        <div class="col-md-4">
                            <img src="{{ product.image.url }}" class="img-fluid rounded-start" alt="">
                        </div>
                        <div class="col-md-8">
                            <div class="card-body">
                                <h5 class="card-title">{{ product.name }}</h5>
                                <p class="card-text">{{ product.description }}</p>
                                <p class="card-text"><small class="text-body-secondary">Last updated 3 minutes ago</small></p>
                                    <!-- Bookmark Button -->
                                <button type= "button" value="{{ product.id }}" class="btn btn-primary bookmarkButton" id="bookmark_cart">
                                    Bookmarked
                                </button>
                            </div>
    
                        </div>
    
                    </div>
                </div>
                    {% endfor %}
                    {% else %}
                    There's nothing in your cart 
                    {% endif %}

<!-- Bootstrap JS and dependencies -->
<script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/js/bootstrap.bundle.min.js"></script>

<!-- Custom JS to toggle bookmark state -->
<script>

                $(document).on('click', '#bookmark_cart', function(e){
                    e.preventDefault();
                    $.ajax({
                        type:'POST',
                        url:"{% url 'cart_delete' %}",
                        data: {
                            product_id: $('#bookmark_cart').val(),
                            csrfmiddlewaretoken: '{{ csrf_token }}',
                            action: 'post'
                        },

                        success: function(json){
                            location.reload();
                        },

                        error: function(xhr, errmsg, err){

                        }

                    });

                })

    // Function to toggle bookmark state for each button
    // function toggleBookmark(button) {
    //   const icon = button.querySelector('i');
    //   console.log(button.querySelector('i'));
      
    //   // Toggle between bookmark and bookmarked state
    //   if (icon.classList.contains('far')) {
    //     // Change to bookmarked (filled icon)
    //     icon.classList.remove('far');
    //     icon.classList.add('fas');
    //     button.classList.remove('btn-outline-primary');
    //     button.classList.add('btn-primary');
    //     button.querySelector('span').textContent = ' Bookmarked';  // Update text
    //   } else {
    //     // Change to unbookmarked (outline icon)
    //     icon.classList.remove('fas');
    //     icon.classList.add('far');
    //     button.classList.remove('btn-primary');
    //     button.classList.add('btn-outline-primary');
    //     button.querySelector('span').textContent = ' Bookmark';  // Update text
    //   }
    // }
  
    // // Attach event listeners to all dynamically created buttons
    // document.querySelectorAll('.bookmarkButton').forEach(button => {
    //   button.addEventListener('click', function() {
    //     // e.preventDefault();
    //     toggleBookmark(this);  // Pass the clicked button to toggleBookmark function

    //     $.ajax({
    //         type: 'POST',
    //         url: "{% url 'cart_delete' %}",
    //         data: {
    //             product_id: $(this).data('index'),
    //             csrfmiddlewaretoken: '{{ csrf_token }}',
    //             action: 'post'
    //         },
    //         success: function(json){
    //             location.reload();
    //         },
    //         error: function(xhr, errmsg, err){

    //         }
    //     });

    //   });
    // });

    
  </script>

        <br/><br/><br/><br/><br/><br/><br/><br/><br/><br/><br/><br/><br/><br/><br/><br/><br/><br/><br/><br/><br/><br/><br/><br/><br/><br/><br/><br/>
        <!-- Footer Section -->
        {% include 'footer.html' %}
    </body>
</html>
